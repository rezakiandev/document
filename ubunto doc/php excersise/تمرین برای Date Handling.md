---
tags:
  - DateHandling
  - حسابگر_سن
---









### **🚀 تمرین: حسابگر سن در PHP**

✅ **وظیفه:** برنامه‌ای که تاریخ تولد کاربر را دریافت کند، سن او را بر اساس تاریخ فعلی محاسبه کرده و تعداد سال‌ها، ماه‌ها و روزهای اختلاف را نمایش دهد.

---

## **📌 سودوکد**

1️⃣ دریافت تاریخ تولد از کاربر.  
2️⃣ دریافت تاریخ فعلی.  
3️⃣ بررسی فرمت ورودی کاربر.  
4️⃣ محاسبه اختلاف بین دو تاریخ.  
5️⃣ نمایش تعداد سال‌ها، ماه‌ها و روزهای اختلاف.

---

## **🔹 کد PHP:**

```php
<?php
// 1️⃣ تنظیم منطقه زمانی
date_default_timezone_set("Europe/Madrid");

// 2️⃣ دریافت تاریخ تولد از ورودی کاربر
echo "لطفاً تاریخ تولد خود را وارد کنید (YYYY-MM-DD): ";
$birthDate = trim(fgets(STDIN));

// 3️⃣ بررسی صحت فرمت ورودی
if (!preg_match("/^\d{4}-\d{2}-\d{2}$/", $birthDate)) {
    echo "⚠ فرمت تاریخ نامعتبر است. لطفاً تاریخ را به‌صورت YYYY-MM-DD وارد کنید.\n";
    exit;
}

// 4️⃣ ایجاد اشیاء DateTime برای مقایسه دو تاریخ
$birthDateObj = new DateTime($birthDate);
$currentDateObj = new DateTime();

// 5️⃣ محاسبه اختلاف بین تاریخ تولد و تاریخ فعلی
$ageDiff = $birthDateObj->diff($currentDateObj);

// 6️⃣ نمایش خروجی
echo "سن شما: " . $ageDiff->y . " سال، " . $ageDiff->m . " ماه و " . $ageDiff->d . " روز است.\n";
?>
```

---

## **🔍 توضیح کامل کد و توابع استفاده‌شده**

### **1️⃣ `date_default_timezone_set()` - تنظیم منطقه زمانی**

```php
date_default_timezone_set("Europe/Madrid");
```

🔹 این تابع منطقه زمانی پیش‌فرض برنامه را تنظیم می‌کند.  
🔹 اگر این تابع را تنظیم نکنیم، ممکن است تاریخ و زمان نادرست نمایش داده شود.  
🔹 **ورودی:** یک رشته حاوی نام منطقه زمانی (مثلاً `"Europe/Madrid"`)  
🔹 **خروجی:** مقدار `true` در صورت موفقیت، `false` در صورت خطا.  
✅ **مثال:**

```php
date_default_timezone_set("Asia/Tehran");
echo date("Y-m-d H:i:s");
```

🔹 خروجی:

```
2025-02-27 14:30:00
```

(بر اساس منطقه زمانی تهران)

---

### **2️⃣ `fgets(STDIN)` - دریافت ورودی از کاربر**

```php
echo "لطفاً تاریخ تولد خود را وارد کنید (YYYY-MM-DD): ";
$birthDate = trim(fgets(STDIN));
```

🔹 این تابع مقدار ورودی را از کاربر دریافت می‌کند.  
🔹 `fgets(STDIN)` → خواندن مقدار ورودی از کنسول.  
🔹 `trim()` → حذف فضاهای خالی اضافی از ابتدا و انتهای ورودی.

✅ **مثال:**

```
لطفاً تاریخ تولد خود را وارد کنید (YYYY-MM-DD): 2000-06-25
```

(متغیر `$birthDate` مقدار `"2000-06-25"` را خواهد داشت.)

---

### **3️⃣ `preg_match()` - بررسی صحت فرمت تاریخ**

```php
if (!preg_match("/^\d{4}-\d{2}-\d{2}$/", $birthDate)) {
    echo "⚠ فرمت تاریخ نامعتبر است. لطفاً تاریخ را به‌صورت YYYY-MM-DD وارد کنید.\n";
    exit;
}
```

🔹 **هدف:** بررسی می‌کند که آیا تاریخ ورودی در قالب صحیح `YYYY-MM-DD` است یا خیر.  
🔹 **`preg_match()`** یک تابع برای بررسی عبارات منظم (regex) است.  
🔹 **ورودی:**

- الگوی `/^\d{4}-\d{2}-\d{2}$/` (تاریخی با 4 رقم سال، 2 رقم ماه و 2 رقم روز)
- مقدار `$birthDate` که کاربر وارد کرده است.  
    🔹 **خروجی:**
- اگر مقدار وارد شده مطابق فرمت `YYYY-MM-DD` باشد → مقدار `true`
- در غیر این صورت → مقدار `false` و پیام خطا نمایش داده شده و برنامه متوقف می‌شود.

✅ **مثال ورودی‌های معتبر و نامعتبر:**

```
✅ 2000-05-15  → صحیح
❌ 15/05/2000  → نادرست
❌ 2000-5-3    → نادرست
```

---

### **4️⃣ `new DateTime()` - ایجاد اشیاء تاریخ**

```php
$birthDateObj = new DateTime($birthDate);
$currentDateObj = new DateTime();
```

🔹 **هدف:** تبدیل رشته‌ی تاریخ به یک شیء `DateTime` برای انجام عملیات تاریخ.  
🔹 **ورودی:**

- `$birthDate` → رشته‌ی تاریخ تولد که از کاربر دریافت شده است.
- مقدار `new DateTime()` بدون ورودی → تاریخ جاری سیستم را دریافت می‌کند.  
    🔹 **خروجی:**
- `$birthDateObj` → شیئی حاوی تاریخ تولد.
- `$currentDateObj` → شیئی حاوی تاریخ امروز.

✅ **مثال:**

```php
$date1 = new DateTime("2000-06-25");
echo $date1->format("Y-m-d"); // خروجی: 2000-06-25
```

---

### **5️⃣ `diff()` - محاسبه اختلاف بین دو تاریخ**

```php
$ageDiff = $birthDateObj->diff($currentDateObj);
```

🔹 این متد اختلاف بین دو شیء `DateTime` را محاسبه می‌کند.  
🔹 **ورودی:** شیء `DateTime` که باید مقایسه شود.  
🔹 **خروجی:** یک شیء `DateInterval` که شامل اختلاف به صورت `سال، ماه و روز` است.

✅ **مثال:**

```php
$date1 = new DateTime("2000-05-20");
$date2 = new DateTime("2025-02-27");
$diff = $date1->diff($date2);
echo $diff->y . " سال، " . $diff->m . " ماه و " . $diff->d . " روز";
```

🔹 خروجی:

```
24 سال، 9 ماه و 7 روز
```

---

### **6️⃣ نمایش خروجی**

```php
echo "سن شما: " . $ageDiff->y . " سال، " . $ageDiff->m . " ماه و " . $ageDiff->d . " روز است.\n";
```

🔹 مقدار `y` تعداد سال‌ها را نشان می‌دهد.  
🔹 مقدار `m` تعداد ماه‌ها را نشان می‌دهد.  
🔹 مقدار `d` تعداد روزها را نشان می‌دهد.

✅ **نمونه ورودی و خروجی:**

```
لطفاً تاریخ تولد خود را وارد کنید (YYYY-MM-DD): 2000-06-25
سن شما: 24 سال، 8 ماه و 2 روز است.
```

---

## **📌 جمع‌بندی و بررسی توابع استفاده‌شده**

|تابع|توضیح|
|---|---|
|`date_default_timezone_set()`|تنظیم منطقه زمانی پیش‌فرض برای برنامه|
|`fgets(STDIN)`|دریافت ورودی از کاربر|
|`trim()`|حذف فضای اضافی در ورودی|
|`preg_match()`|بررسی فرمت تاریخ ورودی با regex|
|`new DateTime()`|ایجاد یک شیء `DateTime` برای کار با تاریخ‌ها|
|`diff()`|محاسبه اختلاف بین دو تاریخ و برگرداندن یک شیء `DateInterval`|
|`format("Y-m-d")`|تبدیل تاریخ به فرمت مشخص|

✅ این برنامه تاریخ تولد را دریافت کرده و سن دقیق کاربر را با اختلاف سال، ماه و روز نمایش می‌دهد. 🚀 اگر سوالی داشتی، بپرس!
---


### **🚀 تمرین ۲: محاسبه تعداد روزهای باقی‌مانده تا سال جدید در PHP**

✅ **هدف:**  
برنامه‌ای که تعداد روزهای باقی‌مانده تا **سال جدید** را محاسبه و نمایش دهد.

---

## **📌 سودوکد**

1️⃣ دریافت تاریخ امروز.  
2️⃣ محاسبه **اول ژانویه سال بعد**.  
3️⃣ محاسبه اختلاف بین این دو تاریخ.  
4️⃣ نمایش تعداد روزهای باقی‌مانده.

---

## **🔹 کد PHP کامل**

```php
<?php
// 1️⃣ تنظیم منطقه زمانی
date_default_timezone_set("Europe/Madrid");

// 2️⃣ دریافت تاریخ امروز
$today = new DateTime();

// 3️⃣ دریافت تاریخ اول ژانویه سال بعد
$nextYear = new DateTime(($today->format("Y") + 1) . "-01-01");

// 4️⃣ محاسبه اختلاف بین دو تاریخ
$diff = $today->diff($nextYear);

// 5️⃣ نمایش تعداد روزهای باقی‌مانده
echo "تا سال جدید " . $diff->days . " روز باقی مانده است.\n";
?>
```

---

## **🔍 توضیح کامل کد و توابع استفاده‌شده**

### **1️⃣ تنظیم منطقه زمانی**

```php
date_default_timezone_set("Europe/Madrid");
```

🔹 **تابع `date_default_timezone_set()`** منطقه زمانی پیش‌فرض برنامه را تنظیم می‌کند.  
🔹 **ورودی (پارامترها):**

- یک رشته (`string`) که نام منطقه زمانی را مشخص می‌کند، مثل `"Europe/Madrid"`.  
    🔹 **خروجی:**
- مقدار `true` در صورت موفقیت و `false` در صورت خطا.

✅ **مثال:**

```php
date_default_timezone_set("Asia/Tehran");
echo date("Y-m-d H:i:s");
```

✅ **خروجی (مثلاً):**

```
2025-02-27 14:30:00
```

(بر اساس منطقه زمانی تهران)

---

### **2️⃣ دریافت تاریخ امروز**

```php
$today = new DateTime();
```

🔹 **کلاس `DateTime`** برای کار با تاریخ و زمان استفاده می‌شود.  
🔹 **ورودی:** اگر مقدار خالی (`""`) باشد، **تاریخ و زمان فعلی سیستم** را دریافت می‌کند.  
🔹 **خروجی:**

- یک شیء `DateTime` که تاریخ و زمان فعلی را نگه می‌دارد.

✅ **مثال:**

```php
$today = new DateTime();
echo $today->format("Y-m-d");
```

✅ **خروجی (مثلاً):**

```
2025-02-27
```

---

### **3️⃣ دریافت تاریخ اول ژانویه سال بعد**

```php
$nextYear = new DateTime(($today->format("Y") + 1) . "-01-01");
```

🔹 **`$today->format("Y")`** → سال جاری را دریافت می‌کند.  
🔹 `+1` → یک واحد به مقدار سال اضافه می‌کند (برای دریافت سال بعد).  
🔹 **تاریخ اول ژانویه‌ی سال بعد ساخته می‌شود.**

✅ **مثال (فرض کنید امروز `2025-02-27` باشد):**

```php
$nextYear = new DateTime("2026-01-01");
echo $nextYear->format("Y-m-d");
```

✅ **خروجی:**

```
2026-01-01
```

---

### **4️⃣ محاسبه اختلاف بین دو تاریخ**

```php
$diff = $today->diff($nextYear);
```

🔹 **تابع `diff()`** اختلاف بین **`$today` (تاریخ امروز)** و **`$nextYear` (۱ ژانویه سال بعد)** را محاسبه می‌کند.  
🔹 **خروجی:**

- یک شیء `DateInterval` که شامل تعداد سال، ماه و روزهای اختلاف است.

✅ **مثال:**

```php
$date1 = new DateTime("2025-02-27");
$date2 = new DateTime("2026-01-01");
$diff = $date1->diff($date2);
echo $diff->days;
```

✅ **خروجی:**

```
308
```

(تعداد روزهای باقی‌مانده تا سال جدید)

---

### **5️⃣ نمایش تعداد روزهای باقی‌مانده**

```php
echo "تا سال جدید " . $diff->days . " روز باقی مانده است.\n";
```

🔹 مقدار **`$diff->days`** تعداد **روزهای باقی‌مانده تا اول ژانویه سال بعد** را نمایش می‌دهد.

✅ **خروجی (فرض کنید امروز 2025-02-27 باشد):**

```
تا سال جدید 308 روز باقی مانده است.
```

---

## **📌 جدول توابع و متدهای استفاده‌شده**

|تابع|توضیح|
|---|---|
|`date_default_timezone_set("Europe/Madrid")`|تنظیم منطقه زمانی برای جلوگیری از مشکلات زمان‌بندی|
|`new DateTime()`|دریافت تاریخ و زمان فعلی|
|`format("Y")`|دریافت سال جاری به‌صورت عددی (مثلاً `2025`)|
|`new DateTime("YYYY-01-01")`|ساخت شیء `DateTime` برای اول ژانویه سال بعد|
|`diff($date2)`|محاسبه اختلاف بین دو شیء `DateTime`|
|`$diff->days`|دریافت تعداد روزهای اختلاف بین دو تاریخ|

---

## **📌 تست کد با مثال‌های مختلف**

✅ **ورودی:**

```php
date_default_timezone_set("Asia/Tehran");
$today = new DateTime("2025-11-15");
$nextYear = new DateTime(($today->format("Y") + 1) . "-01-01");
$diff = $today->diff($nextYear);
echo "تا سال جدید " . $diff->days . " روز باقی مانده است.\n";
```

✅ **خروجی:**

```
تا سال جدید 47 روز باقی مانده است.
```

✅ **ورودی:**

```php
$today = new DateTime("2025-12-31");
```

✅ **خروجی:**

```
تا سال جدید 1 روز باقی مانده است.
```

---

## **📌 مزایای این روش**

✔ **استفاده از `DateTime`** باعث خوانایی و انعطاف‌پذیری بیشتر برنامه می‌شود.  
✔ **بهینه‌سازی شده** و نیازی به محاسبه‌ی دستی ندارد.  
✔ **قابل استفاده در پروژه‌های تقویمی** و یادآوری روزهای باقی‌مانده.

✅ **حالا اگر سوالی داشتی، بپرس! 🚀**